(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function o(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=o(n);fetch(n.href,s)}})();const j=(e,t,o,r)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.add(r.inputErrorClass),n.textContent=o,n.classList.add(r.errorClass)},B=(e,t,o)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),r.textContent="",r.classList.remove(o.errorClass)},H=(e,t,o)=>{t.validity.patternMismatch&&t.dataset.errorMessage?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?B(e,t,o):j(e,t,t.validationMessage,o)},J=e=>e.some(t=>!t.validity.valid),b=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.disabled=!0},z=(e,t)=>{e.classList.remove(t.inactiveButtonClass),e.disabled=!1},K=(e,t,o)=>{J(e)?b(t,o):z(t,o)},R=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);b(r,t),o.forEach(n=>{n.addEventListener("input",()=>{H(e,n,t),K(o,r,t)})})},G=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{R(o,e)})},L=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);o.forEach(n=>{B(e,n,t)}),b(r,t)},Q=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),X=(e,t)=>e.some(o=>o._id===t),$=(e,t,{onPreviewPicture:o,onLikeToggle:r,onDelete:n})=>{const s=Q(),l=s.querySelector(".card__image"),N=s.querySelector(".card__title"),m=s.querySelector(".card__like-button"),I=s.querySelector(".card__like-count"),h=s.querySelector(".card__control-button_type_delete");l.src=e.link,l.alt=e.name,N.textContent=e.name;const V=X(e.likes,t);return m.classList.toggle("card__like-button_is-active",V),I.textContent=e.likes.length,e.owner?._id!==t&&h.remove(),l.addEventListener("click",()=>{o({name:e.name,link:e.link})}),m.addEventListener("click",()=>{const W=m.classList.contains("card__like-button_is-active");r(e._id,W,m,I)}),h&&h.addEventListener("click",()=>{n(e._id,s)}),s},Y=void 0,Z=void 0,c={baseUrl:`https://mesto.nomoreparties.co/v1/${Y}`,headers:{authorization:Z,"Content-Type":"application/json"}},D=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),a=(e,t={})=>fetch(e,t).then(D),ee=()=>a(`${c.baseUrl}/users/me`,{headers:c.headers}),te=()=>a(`${c.baseUrl}/cards`,{headers:c.headers}),oe=({name:e,about:t})=>a(`${c.baseUrl}/users/me`,{method:"PATCH",headers:c.headers,body:JSON.stringify({name:e,about:t})}),re=({avatar:e})=>a(`${c.baseUrl}/users/me/avatar`,{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:e})}),ne=({name:e,link:t})=>a(`${c.baseUrl}/cards`,{method:"POST",headers:c.headers,body:JSON.stringify({name:e,link:t})}),se=e=>a(`${c.baseUrl}/cards/${e}`,{method:"DELETE",headers:c.headers}),ce=(e,t)=>a(`${c.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:c.headers}),M=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");t&&u(t)}},f=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",M)},u=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",M)},le=e=>{const t=e.querySelector(".popup__close");t&&t.addEventListener("click",()=>{u(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&u(e)})},v={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};G(v);const S=document.querySelector(".places__list"),g=document.querySelector(".popup_type_edit"),_=g.querySelector(".popup__form"),w=_.querySelector(".popup__input_type_name"),A=_.querySelector(".popup__input_type_description"),q=document.querySelector(".popup_type_new-card"),i=q.querySelector(".popup__form"),ie=i.querySelector(".popup__input_type_card-name"),ae=i.querySelector(".popup__input_type_url"),C=document.querySelector(".popup_type_image"),T=C.querySelector(".popup__image"),ue=C.querySelector(".popup__caption"),de=document.querySelector(".profile__edit-button"),pe=document.querySelector(".profile__add-button"),k=document.querySelector(".profile__title"),E=document.querySelector(".profile__description"),x=document.querySelector(".profile__image"),P=document.querySelector(".popup_type_edit-avatar"),d=P.querySelector(".popup__form"),_e=d.querySelector(".popup__input");let y=null;const p=(e,t,o,r)=>{e.textContent=t?r:o},U=({name:e,link:t})=>{T.src=t,T.alt=e,ue.textContent=e,f(C)},F=(e,t,o,r)=>{ce(e,t).then(n=>{const s=n.likes.some(l=>l._id===y);o.classList.toggle("card__like-button_is-active",s),r.textContent=n.likes.length}).catch(n=>console.log(n))},O=(e,t)=>{se(e).then(()=>{t.remove()}).catch(o=>console.log(o))},me=e=>{e.preventDefault();const t=_.querySelector(".popup__button"),o=t.textContent;p(t,!0,o,"Сохранение..."),oe({name:w.value,about:A.value}).then(r=>{k.textContent=r.name,E.textContent=r.about,u(g)}).catch(r=>console.log(r)).finally(()=>{p(t,!1,o,"Сохранение...")})},ye=e=>{e.preventDefault();const t=d.querySelector(".popup__button"),o=t.textContent;p(t,!0,o,"Сохранение..."),re({avatar:_e.value}).then(r=>{x.style.backgroundImage=`url(${r.avatar})`,u(P)}).catch(r=>console.log(r)).finally(()=>{p(t,!1,o,"Сохранение..."),d.reset()})},fe=e=>{e.preventDefault();const t=i.querySelector(".popup__button"),o=t.textContent;p(t,!0,o,"Создание..."),ne({name:ie.value,link:ae.value}).then(r=>{S.prepend($(r,y,{onPreviewPicture:U,onLikeToggle:F,onDelete:O})),u(q),i.reset()}).catch(r=>console.log(r)).finally(()=>{p(t,!1,o,"Создание...")})};_.addEventListener("submit",me);i.addEventListener("submit",fe);d.addEventListener("submit",ye);de.addEventListener("click",()=>{w.value=k.textContent,A.value=E.textContent,L(_,v),f(g)});x.addEventListener("click",()=>{d.reset(),L(d,v),f(P)});pe.addEventListener("click",()=>{i.reset(),L(i,v),f(q)});Promise.all([ee(),te()]).then(([e,t])=>{y=e._id,k.textContent=e.name,E.textContent=e.about,x.style.backgroundImage=`url(${e.avatar})`,S.innerHTML="",t.forEach(o=>{S.append($(o,y,{onPreviewPicture:U,onLikeToggle:F,onDelete:O}))})}).catch(e=>console.log(e));document.querySelectorAll(".popup").forEach(e=>{le(e)});
